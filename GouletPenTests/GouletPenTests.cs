using System;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using OpenQA.Selenium.Support.UI;
using OpenQA.Selenium.Chrome;
using GouletPenTestingFramework.Pages;
using OpenQA.Selenium;
using static GouletPenTestingFramework.Entities.Entities;
using System.Collections.Generic;

namespace GouletPenTestingFramework
{
    [TestClass]
    public class UnitTest1
    {
        public IWebDriver Driver { get; set; }
        public WebDriverWait Wait { get; set; }

        [TestInitialize]
        public void SetupTest()
        {
            this.Driver = new ChromeDriver();
            this.Wait = new WebDriverWait(this.Driver, TimeSpan.FromSeconds(30));
        }

        [TestCleanup]
        public void TeardownTest()
        {
            this.Driver.Quit();
        }

        [TestMethod]
        public void AddItemsToCart()
        {
            var penList= new List<Product>
            {
                new Product("Lamy Safari Fountain Pen - Dark Lilac, Fine (Special Edition)", "LMY-L73F"),
                new Product("Lamy Safari Fountain Pen - Shiny Black, Medium", "LMY-L19BKM"),
                new Product ("Noodler's Konrad Acrylic Flex Fountain Pen - Himalayan Ruby", "N14071")
            };

            GouletPenMainPage gouletMainPage = new GouletPenMainPage(this.Driver);
            gouletMainPage.Navigate();

            CartPage cartPage = null;
            //add three pens to the cart
            foreach (var pen in penList)
            {
                var resultsPage = gouletMainPage.Search(pen.ProductCode);
                var productPage = resultsPage.SelectSearchResult(pen.ProductCode);
                
                cartPage=productPage.AddItemToCart();

                gouletMainPage.Navigate();
            }


            //open cart
            cartPage.Navigate();

            //verify that the pens have been added to the cart
            foreach (var pen in penList)
            {
                cartPage.VerifyAddToCart(pen);
            }
        }
    }
}
